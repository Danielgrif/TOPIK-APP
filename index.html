<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOPIK II - Master Pro 2026</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="/app-logo.svg" type="image/svg+xml">
    <meta name="theme-color" content="#6c5ce7">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <audio id="music-player-a" loop preload="auto"></audio>
    <audio id="music-player-b" loop preload="auto"></audio>
    <style>
      /* Critical styles to hide overlays/modals by default */
      .modal,
      #install-banner,
      #level-up-overlay,
      #welcome-overlay,
      #onboarding-overlay,
      #error-overlay,
      #exit-focus-btn {
        display: none;
      }

      /* Active states - show when JS adds these classes */
      .modal.active,
      #level-up-overlay.active,
      #welcome-overlay.active,
      #onboarding-overlay.active,
      #install-banner.show {
        display: flex;
      }

      body.focus-mode #exit-focus-btn {
        display: inline-flex;
      }

      /* Preloader Styles */
      #loading-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: #f5f3ff;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s ease;
        animation: bgPulse 6s ease-in-out infinite alternate;
      }
      @keyframes bgPulse {
        0% { background-color: #f5f3ff; }
        50% { background-color: #e0e7ff; }
        100% { background-color: #ede9fe; }
      }
      .spinner-wrapper {
        position: relative;
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä: –æ—Ç 220px –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–æ 600px –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
        width: clamp(220px, 60vw, 600px);
        height: clamp(220px, 60vw, 600px);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .loader-circle {
        position: absolute;
        width: 100%;
        height: 100%;
        border: clamp(8px, 2vw, 16px) solid rgba(221, 214, 254, 0.4);
        border-radius: 50%;
        border-top-color: #7c3aed;
        animation: spin 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        box-sizing: border-box;
        filter: drop-shadow(0 0 15px rgba(124, 58, 237, 0.3));
      }
      .loader-logo {
        width: 65%;
        height: 65%;
        object-fit: contain;
        animation: logoPopIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3));
      }
      @keyframes spin { 100% { transform: rotate(360deg); } }
      @keyframes logoPopIn {
        from { opacity: 0; transform: scale(0.5); }
        to { opacity: 1; transform: scale(1); }
      }

      @media (prefers-color-scheme: dark) {
        #loading-overlay { 
            background: #1e1b4b;
            animation: bgPulseDark 6s ease-in-out infinite alternate;
        }
        @keyframes bgPulseDark {
            0% { background-color: #1e1b4b; }
            50% { background-color: #312e81; }
            100% { background-color: #2e1065; }
        }
        .loader-circle { 
            border-color: rgba(55, 48, 163, 0.4); 
            border-top-color: #a78bfa; 
        }
      }

      /* Offline Indicator */
      #offline-indicator {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(33, 33, 33, 0.9);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        z-index: 19000;
        display: none;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        backdrop-filter: blur(4px);
        pointer-events: none;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      #offline-indicator.visible {
        display: flex;
        animation: slideUpFade 0.3s ease-out, offlinePulse 2s infinite;
      }
      @keyframes slideUpFade {
        from { opacity: 0; transform: translate(-50%, 10px); }
        to { opacity: 1; transform: translate(-50%, 0); }
      }
      @keyframes offlinePulse {
        0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); border-color: rgba(239, 68, 68, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); border-color: rgba(239, 68, 68, 1); }
        100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); border-color: rgba(239, 68, 68, 0.4); }
      }

      /* Onboarding Styles */
      #onboarding-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* –§–æ–Ω —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SVG-—Å–ª–æ–µ–º .onboarding-backdrop */
        z-index: 21000; /* –í—ã—à–µ —á–µ–º —Ç–æ—Å—Ç—ã –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        display: none;
        justify-content: center;
        align-items: center;
        pointer-events: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∏–∫–∏ (–µ—Å–ª–∏ —Å–∫—Ä—ã—Ç) */
        transition: all 0.3s ease;
        opacity: 0; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
      }
      #onboarding-overlay.active {
        display: flex;
        opacity: 1;
        pointer-events: none; /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–ª–∏–∫–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ SVG */
      }
      .onboarding-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .onboarding-backdrop {
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
        backdrop-filter: blur(5px);      /* –†–∞–∑–º—ã—Ç–∏–µ —Ñ–æ–Ω–∞ */
        -webkit-backdrop-filter: blur(5px);
        transition: background 0.3s;
      }
      .onboarding-click-blocker-path {
        fill: transparent;
        pointer-events: auto;
        transition: d 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      #spotlight-hole {
        transition: x 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), 
                    y 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), 
                    width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), 
                    height 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                    rx 0.4s;
      }
      #spotlight-border {
        fill: none;
        stroke: var(--primary, #6c5ce7); /* –¶–≤–µ—Ç –æ–±–≤–æ–¥–∫–∏ (–±–µ—Ä–µ—Ç—Å—è –∏–∑ —Ç–µ–º—ã) */
        stroke-width: 3;
        pointer-events: none; /* –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∏–∫–∏ */
        transition: x 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), 
                    y 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), 
                    width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), 
                    height 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                    rx 0.4s;
        animation: borderPulse 2s infinite;
      }
      @keyframes borderPulse {
        0% { stroke-opacity: 0.5; stroke-width: 3; }
        50% { stroke-opacity: 1; stroke-width: 5; }
        100% { stroke-opacity: 0.5; stroke-width: 3; }
      }
      .onboarding-close-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(0,0,0,0.3);
        color: white;
        border: none;
        font-size: 20px;
        cursor: pointer;
        z-index: 20; /* –í—ã—à–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s, transform 0.2s;
        pointer-events: auto; /* –ö–Ω–æ–ø–∫–∞ –≤—Å–µ–≥–¥–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ */
      }
      .onboarding-close-btn:hover {
        background: rgba(0,0,0,0.5);
        transform: scale(1.1);
      }
      .onboarding-card {
        background: var(--surface-1, #fff);
        padding: 24px;
        border-radius: 20px;
        width: 90%;
        max-width: 360px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        text-align: center;
        position: fixed; /* –§–∏–∫—Å–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–≤–µ—Ä–ª–µ—è –≤ —Ä–µ–∂–∏–º–µ spotlight */
        /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: auto; /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—Å–µ–≥–¥–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ */
        z-index: 10;
        animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        color: var(--text-main, #000);
      }
      .onboarding-image { font-size: 48px; display: block; margin-bottom: 16px; }
      .onboarding-title { font-size: 20px; font-weight: 800; margin-bottom: 8px; }
      .onboarding-text { font-size: 14px; color: var(--text-sub, #666); margin-bottom: 24px; line-height: 1.5; margin-top: 20px; }
      .onboarding-progress {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 8px;
        background-color: var(--surface-3, #eee);
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        overflow: hidden;
      }
      .onboarding-progress-bar { height: 100%; width: 0%; background-color: var(--primary, #6c5ce7); transition: width 0.4s ease; }
      .onboarding-actions { display: flex; gap: 12px; }

      .onboarding-hand {
        position: fixed;
        font-size: 48px;
        z-index: 21010; /* –í—ã—à–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ —Ñ–æ–Ω–∞ */
        pointer-events: none;
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
        transition: opacity 0.3s, transform 0.3s;
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
        transform-origin: bottom right;
      }
      .onboarding-hand.visible {
        opacity: 1;
        animation: hand-poke 1.5s infinite ease-in-out;
      }
      @keyframes hand-poke {
        0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(-10deg); }
        50% { transform: translate(-45%, -45%) scale(1.1) rotate(10deg); }
      }

      /* Bulk Selection Styles */
      .bulk-bar {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%) translateY(150px);
        background: var(--surface-1);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        z-index: 900;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        width: 90%;
        max-width: 400px;
      }
      .bulk-bar.visible { transform: translateX(-50%) translateY(0); }
      .bulk-count { font-weight: 800; font-size: 16px; color: var(--primary); white-space: nowrap; }
      .bulk-actions { display: flex; gap: 8px; }
      
      .select-checkbox {
        position: absolute; top: 10px; left: 10px; width: 24px; height: 24px;
        border-radius: 50%; border: 2px solid var(--text-sub); background: var(--surface-1);
        z-index: 20; display: none; align-items: center; justify-content: center;
        transition: transform 0.2s;
      }
      .card.select-mode .select-checkbox, .list-item-wrapper.select-mode .select-checkbox { display: flex; }
      .card.selected, .list-item-wrapper.selected .list-item { border-color: var(--primary); background: var(--surface-2); }
      .card.selected .select-checkbox, .list-item-wrapper.selected .select-checkbox {
        background: var(--primary); border-color: var(--primary); color: white;
      }
    </style>
  </head>
  <body>
    <script>
      window.onerror = function(msg, url, line, col, error) {
        console.error("Global Error (Inline):", msg, url, line, error);
      };
    </script>

    <!-- Preloader with Logo -->
    <div id="loading-overlay">
      <div class="spinner-wrapper">
        <div class="loader-circle"></div>
        <img src="/app-logo.svg" class="loader-logo" alt="TOPIK" />
      </div>
    </div>

    <!-- Main App Wrapper -->
    <div id="app-container">
    
    <!-- Exit Focus Mode Button -->
    <button id="exit-focus-btn" class="btn" data-action="toggle-focus">‚úï –í—ã–π—Ç–∏ –∏–∑ —Ñ–æ–∫—É—Å–∞</button>

    <!-- Toast Notifications -->
    <div
      id="toast-container"
      style="
        position: fixed;
        right: 16px;
        bottom: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 20000;
      "
    ></div>

    <!-- Offline Indicator -->
    <div id="offline-indicator">
      <span>üì°</span> <span>–í—ã –æ—Ñ–ª–∞–π–Ω</span>
    </div>

    <!-- Critical Error Overlay -->
    <div id="error-overlay">
      <div>
        <h2>–û—à–∏–±–∫–∞ Supabase</h2>
        <p id="error-msg"></p>
        <button class="btn" data-action="reload">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>

    <!-- Main Header with XP Bar -->
    <div id="main-header">
      <div class="header-top-row">
        <div id="profile-button" data-action="open-profile">
          <div class="avatar" id="profile-avatar">üë§</div>
          <div class="profile-info-col">
            <div id="profile-name">–ì–æ—Å—Ç—å</div>
            <div class="level-badge-header">LVL <span id="user-level">1</span></div>
          </div>
        </div>
        <div class="header-actions">
          <button class="coin-pill" data-action="open-shop"><span id="coins-count-header">0</span> ü™ô</button>
          <button id="header-dark-mode-toggle" class="theme-btn-header" data-action="toggle-dark-mode">‚òÄÔ∏è</button>
        </div>
      </div>
      <div id="xp-level-widget" data-modal-target="stats-modal">
        <div class="xp-track"><div class="xp-bar-fill" id="xp-fill"></div></div>
        <div class="xp-label" id="xp-text">0 / 100 XP</div>
      </div>
      <div id="session-timer" style="display: none; text-align: center; margin-top: 5px; font-size: 12px; color: var(--primary); font-weight: bold; cursor: pointer; position: relative;" onclick="toggleSessionTimer()">
        ‚è± <span id="timer-display">00:00</span>
        <button class="btn-icon" data-action="edit-session-time" style="font-size: 10px; padding: 2px; margin-left: 4px; vertical-align: middle;" onclick="event.stopPropagation()">‚úèÔ∏è</button>
      </div>
    </div>

    <!-- Main Content Area -->
    <main id="main-content">

      <!-- Search and Filter Toolbar -->
      <div class="content-toolbar">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫..." />
            <div class="search-icon">üîç</div>
        </div>
        <div class="toolbar-actions">
            <div class="view-toggles">
                <button class="view-btn active" data-action="toggle-view" data-value="grid">‚ñ¶</button>
                <button class="view-btn" data-action="toggle-view" data-value="list">‚ò∞</button>
            </div>
            <button class="tool-btn" data-action="toggle-select-mode" title="–í—ã–±—Ä–∞—Ç—å">‚òëÔ∏è</button>
            <button class="tool-btn fire-btn" data-action="start-daily-challenge">üî•</button>
            <button class="tool-btn" data-action="toggle-filter-panel">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
            </button>
            <button id="focus-mode-btn" class="tool-btn" data-action="toggle-focus">üëÅÔ∏è</button>
        </div>
      </div>

      <div id="vocabulary-grid" class="grid"></div>
    </main>

    <!-- Bulk Actions Bar -->
    <div id="bulk-bar" class="bulk-bar">
        <div class="bulk-count"><span id="bulk-count-val">0</span></div>
        <div class="bulk-actions">
            <button class="btn-icon" data-action="bulk-select-all" title="–í—ã–±—Ä–∞—Ç—å –≤—Å–µ" style="background: var(--surface-3);">‚àÄ</button>
            <button class="btn-icon" data-action="bulk-move" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ —Ç–µ–º—É" style="background: var(--surface-3);">üè∑Ô∏è</button>
            <button class="btn-icon" data-action="bulk-list" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫" style="background: var(--surface-3);">üìÅ</button>
            <button class="btn-icon" data-action="bulk-delete" title="–£–¥–∞–ª–∏—Ç—å" style="background: rgba(255,0,0,0.1); color: var(--danger);">üóëÔ∏è</button>
            <button class="btn-icon" data-action="toggle-select-mode" title="–û—Ç–º–µ–Ω–∞" style="margin-left: 10px;">‚úï</button>
        </div>
    </div>

    </div> <!-- End of #app-container -->

    <!-- Filter Panel (hidden by default) -->
    <div id="filter-panel">
      <div class="filter-panel-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <h3>üîç –§–∏–ª—å—Ç—Ä—ã</h3>
            <button class="btn-text" data-action="reset-filters" style="font-size: 13px; background: var(--surface-2); padding: 6px 12px; border-radius: 8px;">‚Ü∫ –°–±—Ä–æ—Å</button>
        </div>
        <button class="btn btn-icon close-modal-btn" data-action="toggle-filter-panel">‚úï</button>
      </div>
      <div class="filter-panel-content">
        <div class="filter-section">
          <div class="filter-label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>
          <div class="segment-control" id="type-filters">
              <button class="segment-btn active" data-action="set-type-filter" data-value="word">üìñ –°–ª–æ–≤–∞</button>
              <button class="segment-btn" data-action="set-type-filter" data-value="grammar">üìò –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</button>
          </div>
        </div>
        <div class="filter-section">
          <div class="filter-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</div>
          <div class="filter-chips" id="level-filters">
              <button class="filter-chip active" data-action="set-star-filter" data-value="all">–í—Å–µ</button>
              <button class="filter-chip" data-action="set-star-filter" data-value="‚òÖ‚òÖ‚òÖ">‚òÖ‚òÖ‚òÖ</button>
              <button class="filter-chip" data-action="set-star-filter" data-value="‚òÖ‚òÖ‚òÜ">‚òÖ‚òÖ‚òÜ</button>
              <button class="filter-chip" data-action="set-star-filter" data-value="‚òÖ‚òÜ‚òÜ">‚òÖ‚òÜ‚òÜ</button>
              <button class="filter-chip fav-chip" data-action="set-star-filter" data-value="favorites">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
              <button class="filter-chip mistake-chip" data-action="set-star-filter" data-value="mistakes">‚ö†Ô∏è –û—à–∏–±–∫–∏</button>
          </div>
        </div>
        <div class="filter-section">
          <div class="filter-label">–¢–µ–º–∞</div>
          <button id="topic-filter-btn" class="search-box" style="text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center;" data-modal-target="topic-modal"><span>–í—Å–µ —Ç–µ–º—ã</span> <span>‚Ä∫</span></button>
        </div>
        <div class="filter-section">
          <div class="filter-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
          <button id="category-filter-btn" class="search-box" style="text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center;" data-modal-target="category-modal"><span>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span> <span>‚Ä∫</span></button>
        </div>
        <div class="filter-section">
          <div class="filter-label">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</div>
          <button id="collection-filter-btn" class="search-box" style="text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center;" data-action="open-collections-filter"><span>–í—Å–µ —Å–ª–æ–≤–∞</span> <span>‚Ä∫</span></button>
        </div>
        <div class="filter-section">
          <div class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
          <div class="sort-actions">
            <button class="sort-btn" data-action="sort-topic">
                <span class="sort-icon">üè∑Ô∏è</span>
                <span>–ü–æ —Ç–µ–º–∞–º</span>
            </button>
            <button class="sort-btn" data-action="sort-weak">
                <span class="sort-icon">üí™</span>
                <span>–°–ª–∞–±—ã–µ</span>
            </button>
            <button class="sort-btn" data-action="shuffle">
                <span class="sort-icon">üîÄ</span>
                <span>–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="filter-panel-overlay" data-action="toggle-filter-panel"></div>

    <!-- Bottom Navigation Bar -->
    <div id="bottom-nav">
      <button class="nav-btn active" onclick="document.getElementById('main-content').scrollTo({top: 0});">
        <span class="nav-icon">üè†</span><span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
      </button>
      <button class="nav-btn" data-modal-target="quiz-modal">
        <span class="nav-icon">üéÆ</span><span class="nav-label">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
      </button>
      <button class="nav-btn" data-action="open-review">
        <span class="nav-icon">üîÅ</span><span class="nav-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</span>
        <span id="srs-badge" class="badge-count">0</span>
      </button>
      <button class="nav-btn" data-modal-target="stats-modal">
        <span class="nav-icon">üìä</span><span class="nav-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
      </button>
      <button class="nav-btn" data-modal-target="collections-modal">
        <span class="nav-icon">üìÅ</span><span class="nav-label">–°–ø–∏—Å–∫–∏</span>
      </button>
      <button class="nav-btn" data-modal-target="profile-modal">
        <span class="nav-icon">üë§</span><span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
      </button>
    </div>

    <!-- Stats Modal -->
    <div
      id="stats-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="stats-modal"
    >
      <div class="modal-content">
        <div class="modal-body-container wide">
          <div class="modal-header">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="header-actions">
              <div id="stats-theme-picker" style="display:flex; gap:6px; margin-right:10px; align-items: center;">
                  <button class="stats-color-btn" data-action="set-accent" data-value="purple"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="blue"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="green"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="orange"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="pink"></button>
              </div>
              <button class="btn" data-action="share-stats" style="padding: 6px 12px; font-size: 13px; display: flex; align-items: center; gap: 6px;">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
              <button class="btn btn-icon close-modal-btn" data-close-modal="stats-modal">‚úï</button>
            </div>
          </div>

        <div id="stats-strip" class="stats-strip"></div>

        <div id="stats-details"></div>
        <div id="topic-mastery"></div>
        </div>
      </div>
    </div>

    <!-- Topic Selection Modal -->
    <div
      id="topic-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="topic-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3>üè∑Ô∏è –í—ã–±–æ—Ä —Ç–µ–º—ã</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="topic-modal">‚úï</button>
          </div>
        </div>
        <div id="topic-modal-content" class="filter-modal-body"></div>
      </div>
    </div>

    <!-- Category Selection Modal -->
    <div id="category-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="category-modal">
      <div class="modal-content">
        <div class="modal-header"><h3>üîπ –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3><div class="header-actions"><button class="btn btn-icon close-modal-btn" data-close-modal="category-modal">‚úï</button></div></div>
        <div id="category-modal-content" class="filter-modal-body"></div>
      </div>
    </div>

    <!-- Collections Manager Modal -->
    <div id="collections-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="collections-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞–º–∏</h3>
          <div class="header-actions"><button class="btn btn-icon close-modal-btn" data-close-modal="collections-modal">‚úï</button></div>
        </div>
        
        <div class="collection-create-card">
            <div class="input-group">
                <input type="text" id="new-list-icon" class="search-box" placeholder="üìÅ" style="width: 50px; text-align: center; margin-right: 8px;" maxlength="2">
                <input type="text" id="new-list-title" class="search-box" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞...">
                <button class="btn btn-quiz" data-action="create-list" style="padding: 0 15px;">‚ûï</button>
            </div>
            <div class="collection-options">
                <label class="switch-label">
                    <input type="checkbox" id="new-list-public">
                    <span class="slider-round"></span>
                    <span class="switch-text">–°–¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º</span>
                </label>
            </div>
        </div>

        <div class="section-divider"></div>
        <div class="section-title-sm">–í–∞—à–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</div>

        <div id="collections-list" class="collections-list-container"></div>
      </div>
    </div>

    <!-- Edit List Modal -->
    <div id="edit-list-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="edit-list-modal">
      <div class="modal-content modal-centered" style="max-width: 350px;">
        <div class="modal-header">
          <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
          <div class="header-actions"><button class="btn btn-icon close-modal-btn" data-close-modal="edit-list-modal">‚úï</button></div>
        </div>
        <input type="hidden" id="edit-list-id">
        <div class="input-group" style="margin-bottom: 15px; gap: 10px;">
            <input type="text" id="edit-list-icon" class="search-box" placeholder="üìÅ" style="width: 60px; text-align: center; font-size: 20px;" maxlength="2">
            <input type="text" id="edit-list-title" class="search-box" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞" style="flex: 1;">
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn" onclick="closeModal('edit-list-modal')" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-quiz" data-action="save-list-changes" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Edit Word Modal -->
    <div id="edit-word-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="edit-word-modal">
      <div class="modal-content modal-centered">
        <div class="modal-header">
          <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–≤–∞</h3>
          <div class="header-actions"><button class="btn btn-icon close-modal-btn" data-close-modal="edit-word-modal">‚úï</button></div>
        </div>
        <input type="hidden" id="edit-word-id">
        <div class="input-group" style="margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px;">
            <label class="setting-label">–°–ª–æ–≤–æ (KR)</label>
            <input type="text" id="edit-word-kr" class="search-box" style="width: 100%;">
            <label class="setting-label">–ü–µ—Ä–µ–≤–æ–¥ (RU)</label>
            <input type="text" id="edit-word-ru" class="search-box" style="width: 100%;">
            <label class="setting-label">–¢–µ–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –®–∫–æ–ª–∞)</label>
            <input type="text" id="edit-word-topic" class="search-box" style="width: 100%;" list="topic-suggestions">
            <label class="setting-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ì–ª–∞–≥–æ–ª)</label>
            <input type="text" id="edit-word-category" class="search-box" style="width: 100%;" list="category-suggestions">
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn" data-action="delete-word" style="background: rgba(255,0,0,0.1); color: var(--danger); flex: 1;">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="btn btn-quiz" data-action="save-word-changes" style="flex: 2;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Trash Modal -->
    <div id="trash-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="trash-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üóëÔ∏è –ö–æ—Ä–∑–∏–Ω–∞</h3>
          <div class="header-actions">
            <button id="restore-all-btn" class="btn-text" style="color: var(--success); display: none;">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ</button>
            <button id="empty-trash-btn" class="btn-text" style="color: var(--danger); display: none;">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
            <button class="btn btn-icon close-modal-btn" data-close-modal="trash-modal">‚úï</button>
          </div>
        </div>
        <div id="trash-list" class="trash-list-container">
            <!-- Deleted items will be rendered here -->
        </div>
      </div>
    </div>

    <datalist id="topic-suggestions"></datalist>
    <datalist id="category-suggestions"></datalist>

    <!-- Add Word To List Modal -->
    <div id="add-to-list-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="add-to-list-modal">
      <div class="modal-content">
        <div class="modal-header"><h3>–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫</h3><div class="header-actions"><button class="btn btn-icon close-modal-btn" data-close-modal="add-to-list-modal">‚úï</button></div></div>
        <div id="add-to-list-content" class="filter-modal-body"></div>
      </div>
    </div>

    <!-- Hanja Explorer Modal -->
    <div
      id="hanja-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="hanja-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="hanja-title">Hanja</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="hanja-modal">‚úï</button>
          </div>
        </div>
        <div id="hanja-list" class="hanja-list"></div>
      </div>
    </div>

    <!-- Shop Modal -->
    <div
      id="shop-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="shop-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</h3>
          <div class="header-actions">
            <div class="coin-pill" style="cursor: default;"><span id="shop-balance">0</span> ü™ô</div>
            <button class="btn btn-icon close-modal-btn" data-close-modal="shop-modal">‚úï</button>
          </div>
        </div>
        <div class="shop-tabs">
            <button class="shop-tab active" onclick="window.switchShopTab('shop')">üõí –¢–æ–≤–∞—Ä—ã</button>
            <button class="shop-tab" onclick="window.switchShopTab('inventory')">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        </div>
        <div id="shop-items" class="shop-grid"></div>
        <div id="inventory-items" class="shop-grid" style="display: none;"></div>
      </div>
    </div>

    <!-- Grammar Detail Modal -->
    <div
      id="grammar-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="grammar-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="grammar-title">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="grammar-modal">‚úï</button>
          </div>
        </div>
        <div id="grammar-content" class="grammar-content"></div>
      </div>
    </div>

    <!-- Achievements Modal -->
    <div
      id="achievements-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="achievements-modal"
    >
      <div class="modal-content">
        <div class="modal-body-container">
          <div class="modal-header">
            <h3>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div class="header-actions">
              <button class="btn btn-icon close-modal-btn" data-close-modal="achievements-modal">‚úï</button>
            </div>
          </div>
          <div id="achievements-header" style="text-align: center; margin-bottom: 20px;">
            <!-- Progress will be injected here -->
          </div>
        <div id="achievements-list" class="achievement-grid"></div>
        </div>
      </div>
    </div>

    <!-- Confirm Modal (replaces window.confirm) -->
    <div
      id="confirm-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-action="close-confirm"
    >
      <div class="modal-content" style="text-align: center; position: relative;">
        <button class="btn btn-icon close-modal-btn" data-action="close-confirm" style="position: absolute; top: 15px; right: 15px; z-index: 1;">‚úï</button>
        <div style="font-size: 20px; font-weight: 800; margin-bottom: 10px;">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
        <div style="margin-bottom: 20px; color: var(--text-sub); line-height: 1.5;" id="confirm-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</div>
        <button id="confirm-copy-btn" class="btn-text" style="display: none; margin: -10px auto 15px auto; font-size: 13px; background: var(--surface-3);">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <div id="confirm-input-container" style="display: none; margin-bottom: 15px;">
          <form onsubmit="return false;">
            <input type="password" id="confirm-password" class="search-box" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="width: 100%; text-align: center;">
          </form>
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="btn" id="confirm-no" data-action="close-confirm" style="flex: 1; justify-content: center;">
            –û—Ç–º–µ–Ω–∞
          </button>
          <button class="btn btn-quiz" id="confirm-yes" style="flex: 1; justify-content: center;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Quiz Modal -->
    <div
      id="quiz-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="quiz-modal"
    >
      <div class="modal-content">
        <div class="modal-body-container">
          <div class="modal-header">
            <h3>üéÆ –†–µ–∂–∏–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
            <div class="header-actions">
              <button class="btn btn-icon close-modal-btn" data-close-modal="quiz-modal">‚úï</button>
            </div>
          </div>
        <input type="text" id="quiz-search-input" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏..." style="width: 100%; margin-bottom: 12px; box-sizing: border-box; padding: 10px 15px;">
        <div
          id="quiz-filters"
          style="margin-bottom: 12px; display: flex; gap: 8px"
        >
          <select
            id="quiz-topic-select"
            class="search-box"
            style="padding: 8px; font-size: 13px; flex: 1"
          ></select>
          <select
            id="quiz-category-select"
            class="search-box"
            style="padding: 8px; font-size: 13px; flex: 1"
          ></select>
        </div>
        <div
          id="quiz-difficulty"
          style="margin-bottom: 12px; display: flex; gap: 8px; flex-wrap: wrap"
        ></div>
        <div
          id="quiz-count"
          style="margin-bottom: 12px; color: var(--text-sub); font-weight: 600"
        >
          –°–ª–æ–≤: 0
        </div>
        <div class="quiz-modes" id="quiz-mode-selector"></div>
        <div id="quiz-game">
          <div class="quiz-header">
            <div id="quiz-score" class="quiz-meta-item">–í–æ–ø—Ä–æ—Å 1/10</div>
            <div class="quiz-progress-container">
              <div class="quiz-progress-fill" id="quiz-progress-fill"></div>
            </div>
            <div id="quiz-timer-display" class="quiz-meta-item">00:00</div>
          </div>
          <div class="quiz-body">
            <div class="quiz-question" id="quiz-q"></div>
            <div class="quiz-options" id="quiz-opts"></div>
          </div>
          <div class="quiz-footer"><button class="btn btn-text-only" data-action="quit-quiz">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button></div>
        </div>
        </div>
      </div>
    </div>

    <!-- Custom PWA Install Banner -->
    <div id="install-banner" class="install-banner">
        <div class="install-content">
            <div class="install-icon">üì≤</div>
            <div class="install-text">
                <div class="install-title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                <div class="install-desc">–ó–∞–Ω–∏–º–∞–π—Ç–µ—Å—å –æ—Ñ–ª–∞–π–Ω –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
            </div>
        </div>
        <div class="install-actions">
            <button class="btn-text" data-action="dismiss-banner">–ü–æ–∑–∂–µ</button>
            <button class="btn btn-quiz" data-action="install-app">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- Level Up Overlay -->
    <div id="level-up-overlay" class="level-up-overlay">
        <div class="level-up-content">
            <div class="level-up-icon">üéâ</div>
            <div class="level-up-title">–ù–û–í–´–ô –£–†–û–í–ï–ù–¨!</div>
            <div class="level-up-val" id="level-up-val">5</div>
            <button class="btn btn-quiz" data-action="close-level-up">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- Welcome Overlay -->
    <div id="welcome-overlay" class="level-up-overlay">
        <div class="level-up-content">
            <div class="level-up-icon">üëã</div>
            <div class="level-up-title">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!</div>
            <div class="level-up-val" id="welcome-username"></div>
            <div id="welcome-quote"></div>
            <button class="btn btn-quiz welcome-btn" data-action="close-welcome">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- Add Word Modal -->
    <div id="add-word-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="add-word-modal">
      <div class="modal-content modal-centered">
        <div class="modal-header">
          <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="add-word-modal">‚úï</button>
          </div>
        </div>
        
        <!-- Form View -->
        <div id="add-word-form-view">
            <div style="margin-bottom: 20px; color: var(--text-sub); font-size: 14px; line-height: 1.5;">
            –í–≤–µ–¥–∏—Ç–µ –æ–¥–Ω–æ —Å–ª–æ–≤–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é. –ù–∞—à AI (Gemini 2.5) –Ω–∞–π–¥–µ—Ç –ø–µ—Ä–µ–≤–æ–¥, –ø—Ä–∏–º–µ—Ä—ã –∏ –æ–∑–≤—É—á–∫—É.
            </div>
            
            <div class="input-group" style="margin-bottom: 20px;">
                <textarea id="new-word-input" class="search-box" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ÌïôÍµê, ÏÇ¨Îûë, Í∞ÄÎã§" style="width: 100%; resize: vertical;"></textarea>
                <button class="btn-icon" id="scan-image-btn" title="–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å –∫–∞–º–µ—Ä—ã (–°–∫–æ—Ä–æ)" style="position: absolute; bottom: 10px; right: 10px; width: 32px; height: 32px; font-size: 16px;">üì∑</button>
            </div>
            
            <div style="margin-bottom: 10px; font-size: 14px; font-weight: 600;">–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</div>
            <select id="new-word-target-list" class="search-box" style="width: 100%; margin-bottom: 20px;"></select>

            <details style="margin-bottom: 20px; background: var(--surface-2); border-radius: 8px; padding: 10px;">
                <summary style="cursor: pointer; font-size: 14px; font-weight: 600; color: var(--primary);">üîß –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–º—É/–∫–∞—Ç–µ–≥–æ—Ä–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</summary>
                <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 10px;">
                    <input type="text" id="new-word-topic" class="search-box" placeholder="–¢–µ–º–∞ (–Ω–∞–ø—Ä. –ú–æ–∏ —Å–ª–æ–≤–∞)" style="width: 100%;">
                    <input type="text" id="new-word-category" class="search-box" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä. –°—É—â.)" style="width: 100%;">
                </div>
            </details>

            <button class="btn btn-quiz" data-action="submit-word-request" style="width: 100%;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </div>

        <!-- Progress View (Hidden by default) -->
        <div id="add-word-progress-view" style="display: none; text-align: center; padding: 20px 0;">
            <div class="spinner-wrapper" style="width: 60px; height: 60px; margin: 0 auto 20px;">
                <div class="loader-circle" style="border-width: 4px;"></div>
            </div>
            <h3 style="margin-bottom: 10px;">AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–≤–∞...</h3>
            <div class="progress-container" style="background: var(--surface-3); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                <div id="word-request-progress-bar" style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s;"></div>
            </div>
            <div id="word-request-status-text" style="color: var(--text-sub); font-size: 14px;">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
            <button id="cancel-word-request-btn" class="btn" style="margin-top: 20px; background: var(--surface-2); color: var(--text-sub); font-size: 13px; padding: 8px 16px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="login-modal">
      <div class="modal-content modal-centered auth-modal-content">
        <div class="auth-container">
        <div class="modal-header no-border">
          <h3 id="auth-title">üîê –ü—Ä–æ—Ñ–∏–ª—å</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="login-modal">‚úï</button>
          </div>
        </div>
        <div id="auth-desc" class="auth-description">
          –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –æ–±–ª–∞–∫–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
        </div>
        <form onsubmit="return false;" class="auth-form">
          <div class="input-group">
            <input type="email" id="auth-email" class="auth-input" placeholder="Email" autocomplete="username">
          </div>
          
          <div id="auth-password-container" class="input-group">
              <input type="password" id="auth-password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
              <button type="button" data-action="toggle-password" id="toggle-password-btn" class="password-toggle" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å">üëÅÔ∏è</button>
              <div class="password-strength"><div id="strength-bar"></div></div>
          </div>
        </form>
        
        <div id="auth-buttons" class="auth-actions">
          <button class="btn auth-submit-btn" data-action="auth" data-value="login">–í–æ–π—Ç–∏</button>
          <button class="btn auth-switch-btn" data-action="auth" data-value="signup">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
        <div id="auth-reset-buttons" style="display: none;">
            <button class="btn auth-submit-btn" data-action="auth" data-value="reset">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
        
        <div id="auth-social" class="auth-social-section">
            <div class="auth-separator"><span>–ò–õ–ò</span></div>
            <button class="btn google-btn" data-action="auth-google">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                <span>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
            </button>
        </div>

        <div class="auth-footer">
          <a href="#" id="auth-forgot-link" data-action="toggle-reset-mode" data-value="true">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
          <a href="#" id="auth-back-link" data-action="toggle-reset-mode" data-value="false" style="display: none;">‚Üê –ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É</a>
        </div>
        <div id="auth-error" class="auth-error-msg"></div>
        </div>
      </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="profile-modal">
      <div class="modal-content" style="padding: 0; background: var(--bg);">
        <div class="modal-body-container">
          
          <!-- Header -->
          <div class="profile-header">
            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <button class="btn btn-icon close-modal-btn" data-close-modal="profile-modal">‚úï</button>
          </div>

          <div style="padding: 20px;">
            <!-- User Info Card -->
            <div class="user-profile-card">
                <div class="user-avatar-large" id="profile-avatar-large">üë§</div>
                <div class="profile-name-container" style="display: flex; align-items: center; gap: 8px; justify-content: center; width: 100%;">
                    <div class="user-name" id="profile-name-display" style="margin-bottom: 0;">guest@example.com</div>
                    <button class="btn-icon" id="edit-profile-name-btn" title="–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è" style="font-size: 14px; padding: 4px; width: 24px; height: 24px;">‚úèÔ∏è</button>
                </div>
                <input type="text" id="profile-name-input" class="search-box" style="display: none; text-align: center; margin-bottom: 4px; width: 80%; padding: 8px;" maxlength="20" />
                <div class="user-role" id="profile-role">–°—Ç—É–¥–µ–Ω—Ç</div>
            </div>

            <!-- Appearance -->
            <div class="settings-section">
                <div class="settings-section-title">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üåô</span><span class="setting-label">–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º</span></div>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle-switch" data-action="toggle-dark-mode">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üåó</span><span class="setting-label">–ê–≤—Ç–æ-—Ç–µ–º–∞ (–ø–æ –≤—Ä–µ–º–µ–Ω–∏)</span></div>
                        <label class="switch">
                            <input type="checkbox" id="auto-theme-toggle-switch" data-action="toggle-auto-theme">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item" style="display: block;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div class="setting-left"><span class="setting-icon">üé®</span><span class="setting-label">–¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</span></div>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: space-between; flex-wrap: wrap;">
                            <button class="color-option" data-action="set-accent" data-value="purple"></button>
                            <button class="color-option" data-action="set-accent" data-value="blue"></button>
                            <button class="color-option" data-action="set-accent" data-value="green"></button>
                            <button class="color-option" data-action="set-accent" data-value="orange"></button>
                            <button class="color-option" data-action="set-accent" data-value="pink"></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning & Audio -->
            <div class="settings-section">
                <div class="settings-section-title">–û–±—É—á–µ–Ω–∏–µ</div>
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üâê</span><span class="setting-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å Hanja</span></div>
                        <label class="switch">
                            <input type="checkbox" id="hanja-setting-check" data-action="toggle-hanja">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item" onclick="document.getElementById('voice-setting-btn').click()" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üó£Ô∏è</span><span class="setting-label">–ì–æ–ª–æ—Å</span></div>
                        <div class="setting-right">
                            <button id="voice-setting-btn" class="btn-text" data-action="toggle-voice">üë© –ñ–µ–Ω—Å–∫–∏–π</button>
                        </div>
                    </div>
                    <div class="setting-item" style="display: block;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <div class="setting-left"><span class="setting-icon">‚è©</span><span class="setting-label">–°–∫–æ—Ä–æ—Å—Ç—å</span></div>
                            <span id="speed-val" class="setting-value">1.0x</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px;">üê¢</span>
                            <input type="range" id="speed-slider" min="0.5" max="1.5" step="0.1" value="0.9" style="flex: 1;" data-action="set-speed">
                            <span style="font-size: 12px;">üêá</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üéµ</span><span class="setting-label">–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞</span></div>
                        <label class="switch">
                            <input type="checkbox" id="background-music-check" data-action="toggle-music">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üîä</span><span class="setting-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å</span></div>
                        <div class="setting-right" style="flex: 1; justify-content: flex-end;">
                            <input type="range" id="background-music-volume-slider" min="0" max="1" step="0.05" value="0.3" style="width: 80px;" data-action="set-music-volume">
                        </div>
                    </div>
                </div>
            </div>

            <!-- App & Data -->
            <div class="settings-section">
                <div class="settings-section-title">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                <div class="settings-list">
                    <button id="install-app-btn" class="setting-item" data-action="install-app" style="width: 100%; display: none; color: var(--primary);">
                        <div class="setting-left"><span class="setting-icon">üì≤</span><span class="setting-label">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span></div>
                    </button>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üîÑ</span><span class="setting-label">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span></div>
                        <label class="switch">
                            <input type="checkbox" id="auto-update-check" data-action="toggle-auto-update">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üß†</span><span class="setting-label">AI –ú–æ–¥–µ–ª—å</span></div>
                        <div class="setting-right"><span class="setting-value" style="font-size: 12px; background: var(--surface-3); padding: 4px 8px; border-radius: 6px;">Gemini 2.5 Flash</span></div>
                    </div>
                    <div class="setting-item" data-modal-target="quotes-modal" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üìú</span><span class="setting-label">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</span></div>
                        <div class="setting-right"><span class="setting-arrow">‚Ä∫</span></div>
                    </div>
                    <div class="setting-item" data-modal-target="trash-modal" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üóëÔ∏è</span><span class="setting-label">–ö–æ—Ä–∑–∏–Ω–∞</span></div>
                        <div class="setting-right"><span id="trash-count-badge" class="badge-count" style="display: none;">0</span><span class="setting-arrow">‚Ä∫</span></div>
                    </div>
                    <div class="setting-item" style="display: block;">
                        <div class="setting-left" style="margin-bottom: 10px;"><span class="setting-icon">‚è≥</span><span class="setting-label">–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ</span></div>
                        <div class="segment-control" id="trash-retention-options">
                            <button class="segment-btn" data-action="set-trash-retention" data-value="7">7 –¥–Ω.</button>
                            <button class="segment-btn" data-action="set-trash-retention" data-value="30">30 –¥–Ω.</button>
                            <button class="segment-btn" data-action="set-trash-retention" data-value="90">90 –¥–Ω.</button>
                            <button class="segment-btn" data-action="set-trash-retention" data-value="365">1 –≥–æ–¥</button>
                        </div>
                    </div>
                    <div class="setting-item" data-modal-target="achievements-modal" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üèÜ</span><span class="setting-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span></div>
                        <div class="setting-right"><span class="setting-arrow">‚Ä∫</span></div>
                    </div>
                    <div class="setting-item" data-action="reset-onboarding" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üéì</span><span class="setting-label">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</span></div>
                    </div>
                    <div class="setting-item" data-action="export-data" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üíæ</span><span class="setting-label">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span></div>
                    </div>
                    <div class="setting-item" onclick="document.getElementById('import-file').click()" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üìÇ</span><span class="setting-label">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span></div>
                    </div>
                </div>
            </div>

            <!-- Account Actions -->
            <div class="settings-section">
                <div class="settings-section-title">–ê–∫–∫–∞—É–Ω—Ç</div>
                <div class="settings-list">
                    <div class="setting-item" style="flex-direction: column; align-items: stretch; gap: 10px;">
                        <div class="setting-left"><span class="setting-icon">üîê</span><span class="setting-label">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</span></div>
                        <form onsubmit="return false;" style="display: flex; gap: 10px; width: 100%;">
                            <div style="position: relative; flex: 1;">
                                <input type="password" id="new-password" class="search-box" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" autocomplete="new-password" style="padding-right: 35px;">
                                <button type="button" data-action="toggle-password" data-value="new-password" class="password-toggle">üëÅÔ∏è</button>
                            </div>
                            <button class="btn" data-action="change-password" style="padding: 8px 12px;">OK</button>
                        </form>
                        <div class="password-strength" id="new-strength-container" style="margin-top: 0;"><div id="new-strength-bar"></div></div>
                    </div>
                    <div class="setting-item" data-action="clear-data" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üóë</span><span class="setting-label" style="color: var(--danger);">–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</span></div>
                    </div>
                    <div class="setting-item" data-action="logout" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üö™</span><span class="setting-label" style="color: var(--danger);">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</span></div>
                    </div>
                </div>
            </div>

            <div id="app-version" style="text-align: center; font-size: 11px; color: var(--text-sub); margin-top: 20px; opacity: 0.5;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Favorite Quotes Modal -->
    <div
      id="quotes-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="quotes-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìú –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="quotes-modal">‚úï</button>
          </div>
        </div>
        <div id="quotes-list" class="quotes-list"></div>
      </div>
    </div>

    <div id="scroll-indicator"></div>

    <div id="card-counter-indicator" class="card-counter-indicator">1 / 100</div>

    <input type="file" id="import-file" style="display: none" onchange="importProgress(event)" />

    <script type="module" src="/src/app.ts"></script>
  </body>
</html>
