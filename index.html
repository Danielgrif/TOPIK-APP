<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TOPIK II - Master Pro 2026</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="./favicon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#6c5ce7">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/woff2/Pretendard-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/woff2/Pretendard-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="/src/css/style.css" />
    <audio id="music-player-a" loop preload="auto"></audio>
    <audio id="music-player-b" loop preload="auto"></audio>
    <style>
      /* Critical styles to hide overlays/modals by default */
      .modal,
      #install-banner,
      #level-up-overlay,
      #welcome-overlay,
      #onboarding-overlay,
      #error-overlay,
      #loading-screen,
      #exit-focus-btn {
        display: none;
      }

      /* Active states - show when JS adds these classes */
      .modal.active,
      #level-up-overlay.active,
      #welcome-overlay.active,
      #onboarding-overlay.active,
      #install-banner.show,
      #loading-screen.active {
        display: flex;
      }

      body.focus-mode #exit-focus-btn {
        display: inline-flex;
      }
    </style>
  </head>
  <body>
    <script>
      window.onerror = function(msg, url, line, col, error) {
        console.error("Global Error (Inline):", msg, url, line, error);
      };
    </script>
    <!-- Main App Wrapper -->
    <div id="app-container">
    
    <!-- Exit Focus Mode Button -->
    <button id="exit-focus-btn" class="btn" data-action="toggle-focus">‚úï –í—ã–π—Ç–∏ –∏–∑ —Ñ–æ–∫—É—Å–∞</button>

    <!-- Toast Notifications -->
    <div
      id="toast-container"
      style="
        position: fixed;
        right: 16px;
        bottom: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 20000;
      "
    ></div>

    <!-- Critical Error Overlay -->
    <div id="error-overlay">
      <div>
        <h2>–û—à–∏–±–∫–∞ Supabase</h2>
        <p id="error-msg"></p>
        <button class="btn" data-action="reload">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="level-up-overlay">
        <div class="level-up-content">
            <div class="loader-circle"></div>
            <div style="margin-top: 20px; font-weight: 600; font-size: 18px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <!-- Main Header with XP Bar -->
    <div id="main-header">
      <div class="header-top-row">
        <div id="profile-button" data-action="open-profile">
          <div class="avatar" id="profile-avatar">üë§</div>
          <div class="profile-info-col">
            <div id="profile-name">–ì–æ—Å—Ç—å</div>
            <div class="level-badge-header">LVL <span id="user-level">1</span></div>
          </div>
        </div>
        <div class="header-actions">
          <button class="coin-pill" data-action="open-shop"><span id="coins-count-header">0</span> ü™ô</button>
          <button id="header-dark-mode-toggle" class="theme-btn-header" data-action="toggle-dark-mode">‚òÄÔ∏è</button>
        </div>
      </div>
      <div id="xp-level-widget" data-modal-target="stats-modal">
        <div class="xp-track"><div class="xp-bar-fill" id="xp-fill"></div></div>
        <div class="xp-label" id="xp-text">0 / 100 XP</div>
      </div>
    </div>

    <!-- Main Content Area -->
    <main id="main-content">

      <!-- Search and Filter Toolbar -->
      <div class="content-toolbar">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫..." />
            <div class="search-icon">üîç</div>
        </div>
        <div class="toolbar-actions">
            <div class="view-toggles">
                <button class="view-btn active" data-action="toggle-view" data-value="grid">‚ñ¶</button>
                <button class="view-btn" data-action="toggle-view" data-value="list">‚ò∞</button>
            </div>
            <button class="tool-btn" data-action="toggle-session" title="–¢–∞–π–º–µ—Ä —Å–µ—Å—Å–∏–∏">‚è±</button>
            <button class="tool-btn fire-btn" data-action="start-daily-challenge">üî•</button>
            <button class="tool-btn" data-action="toggle-filter-panel">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
            </button>
            <button id="focus-mode-btn" class="tool-btn" data-action="toggle-focus">üëÅÔ∏è</button>
        </div>
      </div>

      <div id="vocabulary-grid" class="grid"></div>
    </main>

    <!-- Floating Action Button for Adding Words -->
    <button class="fab-btn" data-modal-target="add-word-modal" title="–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–ª–æ–≤–æ">+</button>

    </div> <!-- End of #app-container -->

    <!-- Filter Panel (hidden by default) -->
    <div id="filter-panel">
      <div class="filter-panel-header">
        <h3>üîç –§–∏–ª—å—Ç—Ä—ã</h3>
        <button class="btn btn-icon close-modal-btn" data-action="toggle-filter-panel">‚úï</button>
      </div>
      <div class="filter-panel-content">
        <div class="filter-section">
          <div class="filter-label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>
          <div class="segment-control" id="type-filters">
              <button class="segment-btn active" data-action="set-type-filter" data-value="word">üìñ –°–ª–æ–≤–∞</button>
              <button class="segment-btn" data-action="set-type-filter" data-value="grammar">üìò –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</button>
          </div>
        </div>
        <div class="filter-section">
          <div class="filter-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</div>
          <div class="filter-chips" id="level-filters">
              <button class="filter-chip active" data-action="set-star-filter" data-value="all">–í—Å–µ</button>
              <button class="filter-chip" data-action="set-star-filter" data-value="‚òÖ‚òÖ‚òÖ">‚òÖ‚òÖ‚òÖ</button>
              <button class="filter-chip" data-action="set-star-filter" data-value="‚òÖ‚òÖ‚òÜ">‚òÖ‚òÖ‚òÜ</button>
              <button class="filter-chip" data-action="set-star-filter" data-value="‚òÖ‚òÜ‚òÜ">‚òÖ‚òÜ‚òÜ</button>
              <button class="filter-chip fav-chip" data-action="set-star-filter" data-value="favorites">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
              <button class="filter-chip mistake-chip" data-action="set-star-filter" data-value="mistakes">‚ö†Ô∏è –û—à–∏–±–∫–∏</button>
          </div>
        </div>
        <div class="filter-section">
          <div class="filter-label">–¢–µ–º–∞</div>
          <div id="topicSelect" class="custom-select-container"></div>
        </div>
        <div class="filter-section">
          <div class="filter-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
          <div class="custom-select-wrapper">
            <select id="categorySelect" class="custom-select" onchange="handleCategoryChange(this.value)">
                <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            </select>
            <div class="select-arrow">‚ñº</div>
          </div>
        </div>
        <div class="filter-section">
          <div class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
          <div class="sort-actions">
            <button class="sort-btn" data-action="sort-weak">
                <span class="sort-icon">üí™</span>
                <span>–°–ª–∞–±—ã–µ</span>
            </button>
            <button class="sort-btn" data-action="shuffle">
                <span class="sort-icon">üîÄ</span>
                <span>–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="filter-panel-overlay" data-action="toggle-filter-panel"></div>

    <!-- Bottom Navigation Bar -->
    <div id="bottom-nav">
      <button class="nav-btn active" onclick="document.getElementById('main-content').scrollTo({top: 0});">
        <span class="nav-icon">üè†</span><span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
      </button>
      <button class="nav-btn" data-modal-target="quiz-modal">
        <span class="nav-icon">üéÆ</span><span class="nav-label">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
      </button>
      <button class="nav-btn" data-action="open-review">
        <span class="nav-icon">üîÅ</span><span class="nav-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</span>
        <span id="srs-badge" class="badge-count">0</span>
      </button>
      <button class="nav-btn" data-modal-target="stats-modal">
        <span class="nav-icon">üìä</span><span class="nav-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
      </button>
      <button class="nav-btn" data-modal-target="profile-modal">
        <span class="nav-icon">üë§</span><span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
      </button>
    </div>

    <!-- Stats Modal -->
    <div
      id="stats-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="stats-modal"
    >
      <div class="modal-content">
        <div class="modal-body-container wide">
          <div class="modal-header">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="header-actions">
              <div id="stats-theme-picker" style="display:flex; gap:6px; margin-right:10px; align-items: center;">
                  <button class="stats-color-btn" data-action="set-accent" data-value="purple"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="blue"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="green"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="orange"></button>
                  <button class="stats-color-btn" data-action="set-accent" data-value="pink"></button>
              </div>
              <button class="btn" data-action="share-stats" style="padding: 6px 12px; font-size: 13px; display: flex; align-items: center; gap: 6px;">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
              <button class="btn btn-icon close-modal-btn" data-close-modal="stats-modal">‚úï</button>
            </div>
          </div>

        <div id="stats-strip" class="stats-strip"></div>

        <div id="stats-details"></div>
        <div id="topic-mastery"></div>
        </div>
      </div>
    </div>

    <!-- Hanja Explorer Modal -->
    <div
      id="hanja-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="hanja-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="hanja-title">Hanja</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="hanja-modal">‚úï</button>
          </div>
        </div>
        <div id="hanja-list" class="hanja-list"></div>
      </div>
    </div>

    <!-- Shop Modal -->
    <div
      id="shop-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="shop-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</h3>
          <div class="header-actions">
            <div class="coin-pill" style="cursor: default;"><span id="shop-balance">0</span> ü™ô</div>
            <button class="btn btn-icon close-modal-btn" data-close-modal="shop-modal">‚úï</button>
          </div>
        </div>
        <div class="shop-tabs">
            <button class="shop-tab active" onclick="window.switchShopTab('shop')">üõí –¢–æ–≤–∞—Ä—ã</button>
            <button class="shop-tab" onclick="window.switchShopTab('inventory')">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        </div>
        <div id="shop-items" class="shop-grid"></div>
        <div id="inventory-items" class="shop-grid" style="display: none;"></div>
      </div>
    </div>

    <!-- Grammar Detail Modal -->
    <div
      id="grammar-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="grammar-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="grammar-title">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="grammar-modal">‚úï</button>
          </div>
        </div>
        <div id="grammar-content" class="grammar-content"></div>
      </div>
    </div>

    <!-- Achievements Modal -->
    <div
      id="achievements-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="achievements-modal"
    >
      <div class="modal-content">
        <div class="modal-body-container">
          <div class="modal-header">
            <h3>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div class="header-actions">
              <button class="btn btn-icon close-modal-btn" data-close-modal="achievements-modal">‚úï</button>
            </div>
          </div>
          <div id="achievements-header" style="text-align: center; margin-bottom: 20px;">
            <!-- Progress will be injected here -->
          </div>
        <div id="achievements-list" class="achievement-grid"></div>
        </div>
      </div>
    </div>

    <!-- Confirm Modal (replaces window.confirm) -->
    <div
      id="confirm-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-action="close-confirm"
    >
      <div class="modal-content" style="text-align: center; position: relative;">
        <button class="btn btn-icon close-modal-btn" data-action="close-confirm" style="position: absolute; top: 15px; right: 15px; z-index: 1;">‚úï</button>
        <div style="font-size: 20px; font-weight: 800; margin-bottom: 10px;">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
        <div style="margin-bottom: 20px; color: var(--text-sub); line-height: 1.5;" id="confirm-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</div>
        <div id="confirm-input-container" style="display: none; margin-bottom: 15px;">
          <form onsubmit="return false;">
            <input type="password" id="confirm-password" class="search-box" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="width: 100%; text-align: center;">
          </form>
        </div>
        <div style="display: flex; gap: 10px;">
          <button class="btn" id="confirm-no" data-action="close-confirm" style="flex: 1; justify-content: center;">
            –û—Ç–º–µ–Ω–∞
          </button>
          <button class="btn btn-quiz" id="confirm-yes" style="flex: 1; justify-content: center;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Quiz Modal -->
    <div
      id="quiz-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="quiz-modal"
    >
      <div class="modal-content">
        <div class="modal-body-container">
          <div class="modal-header">
            <h3>üéÆ –†–µ–∂–∏–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
            <div class="header-actions">
              <button class="btn btn-icon close-modal-btn" data-close-modal="quiz-modal">‚úï</button>
            </div>
          </div>
        <input type="text" id="quiz-search-input" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏..." style="width: 100%; margin-bottom: 12px; box-sizing: border-box; padding: 10px 15px;">
        <div
          id="quiz-filters"
          style="margin-bottom: 12px; display: flex; gap: 8px"
        >
          <select
            id="quiz-topic-select"
            class="search-box"
            style="padding: 8px; font-size: 13px; flex: 1"
          ></select>
          <select
            id="quiz-category-select"
            class="search-box"
            style="padding: 8px; font-size: 13px; flex: 1"
          ></select>
        </div>
        <div
          id="quiz-difficulty"
          style="margin-bottom: 12px; display: flex; gap: 8px; flex-wrap: wrap"
        ></div>
        <div
          id="quiz-count"
          style="margin-bottom: 12px; color: var(--text-sub); font-weight: 600"
        >
          –°–ª–æ–≤: 0
        </div>
        <div class="quiz-modes" id="quiz-mode-selector"></div>
        <div id="quiz-game">
          <div class="quiz-header">
            <div id="quiz-score" class="quiz-meta-item">–í–æ–ø—Ä–æ—Å 1/10</div>
            <div class="quiz-progress-container">
              <div class="quiz-progress-fill" id="quiz-progress-fill"></div>
            </div>
            <div id="quiz-timer-display" class="quiz-meta-item">00:00</div>
          </div>
          <div class="quiz-body">
            <div class="quiz-question" id="quiz-q"></div>
            <div class="quiz-options" id="quiz-opts"></div>
          </div>
          <div class="quiz-footer"><button class="btn btn-text-only" data-action="quit-quiz">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button></div>
        </div>
        </div>
      </div>
    </div>

    <!-- Custom PWA Install Banner -->
    <div id="install-banner" class="install-banner">
        <div class="install-content">
            <div class="install-icon">üì≤</div>
            <div class="install-text">
                <div class="install-title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                <div class="install-desc">–ó–∞–Ω–∏–º–∞–π—Ç–µ—Å—å –æ—Ñ–ª–∞–π–Ω –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
            </div>
        </div>
        <div class="install-actions">
            <button class="btn-text" data-action="dismiss-banner">–ü–æ–∑–∂–µ</button>
            <button class="btn btn-quiz" data-action="install-app">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- Level Up Overlay -->
    <div id="level-up-overlay" class="level-up-overlay">
        <div class="level-up-content">
            <div class="level-up-icon">üéâ</div>
            <div class="level-up-title">–ù–û–í–´–ô –£–†–û–í–ï–ù–¨!</div>
            <div class="level-up-val" id="level-up-val">5</div>
            <button class="btn btn-quiz" data-action="close-level-up">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- Welcome Overlay -->
    <div id="welcome-overlay" class="level-up-overlay">
        <div class="level-up-content">
            <div class="level-up-icon">üëã</div>
            <div class="level-up-title">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!</div>
            <div class="level-up-val" id="welcome-username"></div>
            <div id="welcome-quote"></div>
            <button class="btn btn-quiz welcome-btn" data-action="close-welcome">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- Add Word Modal -->
    <div id="add-word-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="add-word-modal">
      <div class="modal-content modal-centered">
        <div class="modal-header">
          <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="add-word-modal">‚úï</button>
          </div>
        </div>
        <div style="margin-bottom: 20px; color: var(--text-sub); font-size: 14px; line-height: 1.5;">
          –í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –Ω–∞ –∫–æ—Ä–µ–π—Å–∫–æ–º. –ù–∞—à AI –Ω–∞–π–¥–µ—Ç –ø–µ—Ä–µ–≤–æ–¥, –ø—Ä–∏–º–µ—Ä—ã –∏ –æ–∑–≤—É—á–∫—É, –ø–æ—Å–ª–µ —á–µ–≥–æ –¥–æ–±–∞–≤–∏—Ç –µ–≥–æ –≤ –æ–±—â—É—é –±–∞–∑—É.
        </div>
        <input type="text" id="new-word-input" class="search-box" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ÌïôÍµê" style="width: 100%; margin-bottom: 20px;">
        <button class="btn btn-quiz" data-action="submit-word-request" style="width: 100%;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
      </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="login-modal">
      <div class="modal-content modal-centered auth-modal-content">
        <div class="auth-container">
        <div class="modal-header no-border">
          <h3 id="auth-title">üîê –ü—Ä–æ—Ñ–∏–ª—å</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="login-modal">‚úï</button>
          </div>
        </div>
        <div id="auth-desc" class="auth-description">
          –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –æ–±–ª–∞–∫–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
        </div>
        <form onsubmit="return false;" class="auth-form">
          <div class="input-group">
            <input type="email" id="auth-email" class="auth-input" placeholder="Email" autocomplete="username">
          </div>
          
          <div id="auth-password-container" class="input-group">
              <input type="password" id="auth-password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
              <button type="button" data-action="toggle-password" id="toggle-password-btn" class="password-toggle" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å">üëÅÔ∏è</button>
              <div class="password-strength"><div id="strength-bar"></div></div>
          </div>
        </form>
        
        <div id="auth-buttons" class="auth-actions">
          <button class="btn auth-submit-btn" data-action="auth" data-value="login">–í–æ–π—Ç–∏</button>
          <button class="btn auth-switch-btn" data-action="auth" data-value="signup">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
        <div id="auth-reset-buttons" style="display: none;">
            <button class="btn auth-submit-btn" data-action="auth" data-value="reset">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
        
        <div id="auth-social" class="auth-social-section">
            <div class="auth-separator"><span>–ò–õ–ò</span></div>
            <button class="btn google-btn" data-action="auth-google">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                <span>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
            </button>
        </div>

        <div class="auth-footer">
          <a href="#" id="auth-forgot-link" data-action="toggle-reset-mode" data-value="true">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
          <a href="#" id="auth-back-link" data-action="toggle-reset-mode" data-value="false" style="display: none;">‚Üê –ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É</a>
        </div>
        <div id="auth-error" class="auth-error-msg"></div>
        </div>
      </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal" role="dialog" aria-modal="true" tabindex="-1" data-close-modal="profile-modal">
      <div class="modal-content" style="padding: 0; background: var(--bg);">
        <div class="modal-body-container">
          
          <!-- Header -->
          <div class="profile-header">
            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <button class="btn btn-icon close-modal-btn" data-close-modal="profile-modal">‚úï</button>
          </div>

          <div style="padding: 20px;">
            <!-- User Info Card -->
            <div class="user-profile-card">
                <div class="user-avatar-large" id="profile-avatar-large">üë§</div>
                <div class="profile-name-container" style="display: flex; align-items: center; gap: 8px; justify-content: center; width: 100%;">
                    <div class="user-name" id="profile-name-display" style="margin-bottom: 0;">guest@example.com</div>
                    <button class="btn-icon" id="edit-profile-name-btn" title="–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è" style="font-size: 14px; padding: 4px; width: 24px; height: 24px;">‚úèÔ∏è</button>
                </div>
                <input type="text" id="profile-name-input" class="search-box" style="display: none; text-align: center; margin-bottom: 4px; width: 80%; padding: 8px;" maxlength="20" />
                <div class="user-role" id="profile-role">–°—Ç—É–¥–µ–Ω—Ç</div>
            </div>

            <!-- Appearance -->
            <div class="settings-section">
                <div class="settings-section-title">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üåô</span><span class="setting-label">–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º</span></div>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle-switch" data-action="toggle-dark-mode">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üåó</span><span class="setting-label">–ê–≤—Ç–æ-—Ç–µ–º–∞ (–ø–æ –≤—Ä–µ–º–µ–Ω–∏)</span></div>
                        <label class="switch">
                            <input type="checkbox" id="auto-theme-toggle-switch" data-action="toggle-auto-theme">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item" style="display: block;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div class="setting-left"><span class="setting-icon">üé®</span><span class="setting-label">–¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</span></div>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: space-between;">
                            <button class="color-option" data-action="set-accent" data-value="purple"></button>
                            <button class="color-option" data-action="set-accent" data-value="blue"></button>
                            <button class="color-option" data-action="set-accent" data-value="green"></button>
                            <button class="color-option" data-action="set-accent" data-value="orange"></button>
                            <button class="color-option" data-action="set-accent" data-value="pink"></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning & Audio -->
            <div class="settings-section">
                <div class="settings-section-title">–û–±—É—á–µ–Ω–∏–µ</div>
                <div class="settings-list">
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üâê</span><span class="setting-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å Hanja</span></div>
                        <label class="switch">
                            <input type="checkbox" id="hanja-setting-check" data-action="toggle-hanja">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item" onclick="document.getElementById('voice-setting-btn').click()" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üó£Ô∏è</span><span class="setting-label">–ì–æ–ª–æ—Å</span></div>
                        <div class="setting-right">
                            <button id="voice-setting-btn" class="btn-text" data-action="toggle-voice">üë© –ñ–µ–Ω—Å–∫–∏–π</button>
                        </div>
                    </div>
                    <div class="setting-item" style="display: block;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <div class="setting-left"><span class="setting-icon">‚è©</span><span class="setting-label">–°–∫–æ—Ä–æ—Å—Ç—å</span></div>
                            <span id="speed-val" class="setting-value">1.0x</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px;">üê¢</span>
                            <input type="range" id="speed-slider" min="0.5" max="1.5" step="0.1" value="0.9" style="flex: 1;" data-action="set-speed">
                            <span style="font-size: 12px;">üêá</span>
                        </div>
                    </div>
                    <div class="setting-item" style="display: block;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <div class="setting-left"><span class="setting-icon">üí¨</span><span class="setting-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å –æ–∑–≤—É—á–∫–∏</span></div>
                            <span id="tts-volume-val" class="setting-value">100%</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px;">üîá</span>
                            <input type="range" id="tts-volume-slider" min="0" max="1" step="0.05" value="1.0" style="flex: 1;" data-action="set-tts-volume">
                            <span style="font-size: 12px;">üîä</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üéµ</span><span class="setting-label">–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞</span></div>
                        <label class="switch">
                            <input type="checkbox" id="background-music-check" data-action="toggle-music">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üîä</span><span class="setting-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å</span></div>
                        <div class="setting-right" style="flex: 1; justify-content: flex-end;">
                            <input type="range" id="background-music-volume-slider" min="0" max="1" step="0.05" value="0.3" style="width: 80px;" data-action="set-music-volume">
                        </div>
                    </div>
                </div>
            </div>

            <!-- App & Data -->
            <div class="settings-section">
                <div class="settings-section-title">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                <div class="settings-list">
                    <button id="install-app-btn" class="setting-item" data-action="install-app" style="width: 100%; display: none; color: var(--primary);">
                        <div class="setting-left"><span class="setting-icon">üì≤</span><span class="setting-label">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span></div>
                    </button>
                    <div class="setting-item">
                        <div class="setting-left"><span class="setting-icon">üîÑ</span><span class="setting-label">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span></div>
                        <label class="switch">
                            <input type="checkbox" id="auto-update-check" data-action="toggle-auto-update">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item" data-modal-target="quotes-modal" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üìú</span><span class="setting-label">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</span></div>
                        <div class="setting-right"><span class="setting-arrow">‚Ä∫</span></div>
                    </div>
                    <div class="setting-item" data-modal-target="achievements-modal" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üèÜ</span><span class="setting-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span></div>
                        <div class="setting-right"><span class="setting-arrow">‚Ä∫</span></div>
                    </div>
                    <div class="setting-item" data-action="export-data" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üíæ</span><span class="setting-label">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span></div>
                    </div>
                    <div class="setting-item" onclick="document.getElementById('import-file').click()" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üìÇ</span><span class="setting-label">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span></div>
                    </div>
                </div>
            </div>

            <!-- Account Actions -->
            <div class="settings-section">
                <div class="settings-section-title">–ê–∫–∫–∞—É–Ω—Ç</div>
                <div class="settings-list">
                    <div class="setting-item" style="flex-direction: column; align-items: stretch; gap: 10px;">
                        <div class="setting-left"><span class="setting-icon">üîê</span><span class="setting-label">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</span></div>
                        <form onsubmit="return false;" style="display: flex; gap: 10px; width: 100%;">
                            <div style="position: relative; flex: 1;">
                                <input type="password" id="new-password" class="search-box" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" autocomplete="new-password" style="padding-right: 35px;">
                                <button type="button" data-action="toggle-password" data-value="new-password" class="password-toggle">üëÅÔ∏è</button>
                            </div>
                            <button class="btn" data-action="change-password" style="padding: 8px 12px;">OK</button>
                        </form>
                        <div class="password-strength" id="new-strength-container" style="margin-top: 0;"><div id="new-strength-bar"></div></div>
                    </div>
                    <div class="setting-item" data-action="clear-data" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üóë</span><span class="setting-label" style="color: var(--danger);">–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</span></div>
                    </div>
                    <div class="setting-item" data-action="logout" style="cursor: pointer;">
                        <div class="setting-left"><span class="setting-icon">üö™</span><span class="setting-label" style="color: var(--danger);">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</span></div>
                    </div>
                </div>
            </div>

            <div id="app-version" style="text-align: center; font-size: 11px; color: var(--text-sub); margin-top: 20px; opacity: 0.5;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Favorite Quotes Modal -->
    <div
      id="quotes-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      tabindex="-1"
      data-close-modal="quotes-modal"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìú –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</h3>
          <div class="header-actions">
            <button class="btn btn-icon close-modal-btn" data-close-modal="quotes-modal">‚úï</button>
          </div>
        </div>
        <div id="quotes-list" class="quotes-list"></div>
      </div>
    </div>

    <div id="scroll-indicator"></div>

    <div id="card-counter-indicator" class="card-counter-indicator">1 / 100</div>

    <input type="file" id="import-file" style="display: none" onchange="importProgress(event)" />

    <script type="module" src="/src/app.ts"></script>
  </body>
</html>
